{"openapi":"3.0.0","info":{"title":"MySagra API Documentation","description":"Hello World!","version":"1.0.0"},"tags":[{"name":"Auth","description":"Authentication and authorization"},{"name":"Users","description":"User management"},{"name":"Roles","description":"Role management"},{"name":"Categories","description":"Category management"},{"name":"Foods","description":"Food management"},{"name":"Ingredients","description":"Ingredient management"},{"name":"Orders","description":"Order management"},{"name":"Printers","description":"Printer management"},{"name":"CashRegisters","description":"Cash Register management"}],"components":{"securitySchemes":{"bearerAuth":{"type":"http","scheme":"bearer","bearerFormat":"JWT"},"cookieAuth":{"type":"apiKey","in":"cookie","name":"refreshToken","description":"HTTP-only refresh token cookie"}},"schemas":{"LoginRequest":{"type":"object","required":["username","password"],"properties":{"username":{"type":"string","description":"User's username","example":"admin"},"password":{"type":"string","description":"User's password","example":"password123"}}},"LoginResponse":{"type":"object","properties":{"user":{"type":"object","properties":{"id":{"type":"string","description":"User's unique identifier","example":"clxyz123456789abcdef"},"username":{"type":"string","description":"User's username","example":"admin"},"role":{"type":"string","description":"User's role name","example":"admin"}}},"accessToken":{"type":"string","description":"JWT access token for authentication (short-lived, expires in 15 minutes)","example":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"}}},"RefreshResponse":{"type":"object","properties":{"accessToken":{"type":"string","description":"New JWT access token (expires in 15 minutes)","example":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"}}},"ErrorResponse":{"type":"object","properties":{"message":{"type":"string","description":"Error message"}}},"SSEMessage":{"type":"object","description":"Server-Sent Event message format","properties":{"data":{"type":"string","description":"JSON stringified event data","example":"{\"id\":123,\"displayCode\":\"A01\",\"table\":\"5\",\"customer\":\"Mario Rossi\"}"}}},"CashRegister":{"type":"object","required":["name","defaultPrinterId"],"properties":{"id":{"type":"string","description":"The auto-generated id of the cash register","example":"clx1a2b3c4d5e6f7g8h9i0j1"},"name":{"type":"string","description":"The name of the cash register","example":"Bar Cash Register"},"enabled":{"type":"boolean","description":"Whether the cash register is enabled","default":true,"example":true},"defaultPrinterId":{"type":"string","description":"The id of the default printer","example":"clx1a2b3c4d5e6f7g8h9i0j1"}}},"CashRegisterInput":{"type":"object","required":["name","defaultPrinterId"],"properties":{"name":{"type":"string","description":"The name of the cash register","example":"Bar Cash Register"},"enabled":{"type":"boolean","description":"Whether the cash register is enabled","default":true,"example":true},"defaultPrinterId":{"type":"string","description":"The id of the default printer","example":"clx1a2b3c4d5e6f7g8h9i0j1"}}},"CashRegisterPatchInput":{"type":"object","required":["enabled"],"properties":{"enabled":{"type":"boolean","description":"Whether the cash register is enabled","example":false}}},"CategoryResponse":{"type":"object","properties":{"id":{"type":"string","example":"clxyz123456789abcdef"},"name":{"type":"string","example":"Pizzeria"},"available":{"type":"boolean","example":true},"position":{"type":"integer","example":1}}},"CategoryRequest":{"type":"object","properties":{"name":{"type":"string","example":"Pizzeria"},"available":{"type":"boolean","example":true},"position":{"type":"integer","example":1},"printerId":{"type":"string","nullable":true,"description":"Optional CUID of the printer associated with this category","example":"clxyz987654321fedcba"}}},"FoodIngredient":{"type":"object","properties":{"id":{"type":"string","format":"cuid","example":"clm1234567890"}}},"Ingredient":{"type":"object","properties":{"id":{"type":"string","format":"cuid","example":"clm1234567890"},"name":{"type":"string","example":"Mozzarella"}}},"FoodResponse":{"type":"object","properties":{"id":{"type":"string","format":"cuid","example":"clm9876543210"},"name":{"type":"string","example":"Pizza"},"description":{"type":"string","example":"Delicious cheese pizza"},"price":{"type":"number","format":"float","example":9.99},"categoryId":{"type":"string","example":"clxyz123456789abcdef"},"printerId":{"type":"string","nullable":true,"description":"CUID of the printer associated with this food item","example":"clxyz987654321fedcba"},"available":{"type":"boolean","example":true},"category":{"type":"object","properties":{"id":{"type":"string","example":"clxyz123456789abcdef"},"name":{"type":"string","example":"Pizzeria"},"available":{"type":"boolean","example":true},"position":{"type":"integer","example":1}}},"ingredients":{"type":"array","description":"Array of ingredients (only included when 'include=ingredients' query parameter is used)","items":{"$ref":"#/components/schemas/Ingredient"}}}},"FoodRequest":{"type":"object","required":["name","price","available","categoryId"],"properties":{"name":{"type":"string","example":"Pizza"},"description":{"type":"string","example":"Delicious cheese pizza"},"price":{"type":"number","format":"float","example":9.99},"categoryId":{"type":"string","example":"clxyz123456789abcdef"},"printerId":{"type":"string","nullable":true,"description":"Optional CUID of the printer associated with this food item","example":"clxyz987654321fedcba"},"available":{"type":"boolean","example":true},"ingredients":{"type":"array","items":{"$ref":"#/components/schemas/FoodIngredient"},"example":[{"id":"clm1234567890"},{"id":"clm0987654321"}]}}},"IngredientResponse":{"type":"object","properties":{"id":{"type":"string","example":"clm1234567890"},"name":{"type":"string","example":"Mozzarella"}}},"IngredientRequest":{"type":"object","required":["name"],"properties":{"name":{"type":"string","example":"Mozzarella"}}},"Error":{"type":"object","properties":{"error":{"type":"string"}},"required":["error"]},"OrderItemInput":{"type":"object","required":["foodId","quantity"],"properties":{"foodId":{"type":"string","format":"cuid","description":"Food item ID","example":"clx1a2b3c4d5e6f7g8h9i0j1"},"quantity":{"type":"integer","minimum":1,"description":"Quantity to order","example":2},"notes":{"type":"string","description":"Optional notes for this specific item","example":"No onions, extra cheese"},"surcharge":{"type":"number","format":"float","default":0,"description":"Surcharge for this item (e.g., extra toppings)","example":1.5},"unitPrice":{"type":"number","format":"float","description":"Unit price of the food item (set automatically by backend)","example":8.5},"total":{"type":"number","format":"float","description":"Total for this item (surcharge + unitPrice * quantity, set automatically by backend)","example":18.5}}},"ConfirmationData":{"type":"object","required":["paymentMethod"],"properties":{"userId":{"type":"string","format":"cuid","description":"User ID who confirmed the order","example":"clx1a2b3c4d5e6f7g8h9i0j1"},"cashRegisterId":{"type":"string","format":"cuid","description":"Cash register ID where the order was confirmed"},"paymentMethod":{"type":"string","enum":["CASH","CARD"],"description":"Payment method used by the customer","example":"CASH"},"discount":{"type":"number","format":"float","minimum":0,"default":0,"description":"Discount amount to subtract from subtotal","example":2.5},"orderItems":{"type":"array","description":"Optional list of order items to replace existing ones","items":{"$ref":"#/components/schemas/OrderItemInput"}}}},"OrderStatus":{"type":"string","enum":["PENDING","CONFIRMED","COMPLETED","PICKED_UP"],"description":"Order status in the lifecycle"},"OrderBase":{"type":"object","properties":{"id":{"type":"integer","description":"Order ID","example":42},"displayCode":{"type":"string","minLength":3,"maxLength":3,"description":"3-character alphanumeric order code","example":"A01"},"table":{"type":"string","description":"Table number or identifier","example":"5"},"customer":{"type":"string","description":"Customer name","example":"Mario Rossi"},"status":{"$ref":"#/components/schemas/OrderStatus"},"subTotal":{"type":"number","format":"decimal","description":"Subtotal before discount/surcharge","example":50},"total":{"type":"number","format":"decimal","description":"Final total amount","example":47},"discount":{"type":"number","format":"decimal","description":"Applied discount","example":5},"surcharge":{"type":"number","format":"decimal","description":"Applied surcharge","example":2},"paymentMethod":{"type":"string","enum":["CASH","CARD"],"nullable":true,"description":"Payment method (null for PENDING orders)","example":"CASH"},"ticketNumber":{"type":"integer","nullable":true,"description":"Daily progressive ticket number (null for PENDING orders)","example":15},"confirmedAt":{"type":"string","format":"date-time","nullable":true,"description":"Order confirmation timestamp","example":"2025-11-12T14:30:00.000Z"},"createdAt":{"type":"string","format":"date-time","description":"Order creation timestamp","example":"2025-11-12T14:00:00.000Z"},"updatedAt":{"type":"string","format":"date-time","description":"Last update timestamp","example":"2025-11-12T14:30:00.000Z"}}},"Category":{"type":"object","properties":{"id":{"type":"integer","example":1},"name":{"type":"string","example":"Pizza"}}},"FoodBasic":{"type":"object","description":"Basic food info returned in order creation","properties":{"id":{"type":"string","example":"clx1a2b3c4d5e6f7g8h9i0j1"},"name":{"type":"string","example":"Pizza Margherita"},"description":{"type":"string","example":"Classic pizza with tomato and mozzarella"},"price":{"type":"string","example":"8.50"},"available":{"type":"boolean","example":true}}},"FoodDetailed":{"type":"object","description":"Detailed food info with category and ingredients","properties":{"id":{"type":"string","example":"clx1a2b3c4d5e6f7g8h9i0j1"},"name":{"type":"string","example":"Pizza Margherita"},"description":{"type":"string","example":"Classic pizza with tomato and mozzarella"},"price":{"type":"string","example":"8.50"},"available":{"type":"boolean","example":true},"category":{"$ref":"#/components/schemas/Category"},"foodIngredients":{"type":"array","items":{"type":"object","properties":{"ingredient":{"$ref":"#/components/schemas/Ingredient"}}}}}},"OrderItemBasic":{"type":"object","description":"Order item with basic food info","properties":{"quantity":{"type":"integer","minimum":1,"example":2},"notes":{"type":"string","description":"Optional notes for this specific item","example":"No onions, extra cheese"},"unitPrice":{"type":"number","format":"decimal","description":"Unit price of the food at time of order","example":8.5},"unitSurcharge":{"type":"number","format":"decimal","description":"Per-unit surcharge (item surcharge / quantity)","example":0.75},"total":{"type":"number","format":"decimal","description":"Total for this item (surcharge + unitPrice * quantity)","example":18.5},"food":{"$ref":"#/components/schemas/FoodBasic"}}},"OrderItemDetailed":{"type":"object","description":"Order item with detailed food info, category and ingredients","properties":{"quantity":{"type":"integer","minimum":1,"example":2},"notes":{"type":"string","description":"Optional notes for this specific item","example":"No onions, extra cheese"},"unitPrice":{"type":"number","format":"decimal","description":"Unit price of the food at time of order","example":8.5},"unitSurcharge":{"type":"number","format":"decimal","description":"Per-unit surcharge (item surcharge / quantity)","example":0.75},"total":{"type":"number","format":"decimal","description":"Total for this item (surcharge + unitPrice * quantity)","example":18.5},"food":{"$ref":"#/components/schemas/FoodDetailed"}}},"OrderListResponse":{"type":"object","description":"Lightweight order object for list/search endpoints (no items details)","properties":{"id":{"type":"string","example":"clx1a2b3c4d5e6f7g8h9i0j1"},"displayCode":{"type":"string","minLength":3,"maxLength":3,"example":"A01"},"table":{"type":"string","example":"5"},"customer":{"type":"string","example":"Mario Rossi"},"subTotal":{"type":"string","example":"25.50"},"status":{"type":"string","enum":["pending","confirmed","completed","cancelled"],"example":"pending"},"createdAt":{"type":"string","format":"date-time","example":"2025-11-04T10:30:00Z"},"updatedAt":{"type":"string","format":"date-time","example":"2025-11-04T10:30:00Z"}}},"CategoryBasic":{"type":"object","description":"Basic category with only id and name","properties":{"id":{"type":"integer","example":1},"name":{"type":"string","example":"Pizza"}}},"FoodWithIngredients":{"type":"object","description":"Food with flat ingredients array","properties":{"id":{"type":"string","example":"clx1a2b3c4d5e6f7g8h9i0j1"},"name":{"type":"string","example":"Pizza Margherita"},"description":{"type":"string","example":"Classic pizza with tomato and mozzarella"},"price":{"type":"string","example":"8.50"},"available":{"type":"boolean","example":true},"ingredients":{"type":"array","description":"Flat array of ingredients","items":{"$ref":"#/components/schemas/Ingredient"}}}},"CategorizedOrderItem":{"type":"object","description":"Order item with food and flat ingredients","properties":{"id":{"type":"string","example":"clx9876543210"},"quantity":{"type":"integer","example":2},"notes":{"type":"string","nullable":true,"description":"Optional notes for this specific item","example":"No onions, extra cheese"},"unitPrice":{"type":"number","format":"decimal","description":"Unit price of the food at time of order","example":8.5},"unitSurcharge":{"type":"number","format":"decimal","description":"Per-unit surcharge (item surcharge / quantity)","example":0.75},"total":{"type":"number","format":"decimal","description":"Total for this item (surcharge + unitPrice * quantity)","example":18.5},"food":{"$ref":"#/components/schemas/FoodWithIngredients"}}},"CategorizedItems":{"type":"object","description":"Items grouped by category","properties":{"category":{"$ref":"#/components/schemas/CategoryBasic"},"items":{"type":"array","items":{"$ref":"#/components/schemas/CategorizedOrderItem"}}}},"OrderDetailResponse":{"type":"object","description":"Complete order object with items grouped by category and flat ingredients array","properties":{"id":{"type":"number","example":23},"displayCode":{"type":"string","minLength":3,"maxLength":3,"example":"A01"},"table":{"type":"string","example":"5"},"customer":{"type":"string","example":"Mario Rossi"},"subTotal":{"type":"string","example":"25.50"},"createdAt":{"type":"string","format":"date-time","example":"2025-11-04T10:30:00Z"},"categorizedItems":{"type":"array","description":"Order items grouped by food category","items":{"$ref":"#/components/schemas/CategorizedItems"}}}},"OrderCreateResponse":{"type":"object","description":"Order response after creation (lightweight, no food details)","properties":{"id":{"type":"string","example":"clx1a2b3c4d5e6f7g8h9i0j1"},"displayCode":{"type":"string","minLength":3,"maxLength":3,"example":"A01"},"table":{"type":"string","example":"5"},"customer":{"type":"string","example":"Mario Rossi"},"subTotal":{"type":"string","example":"25.50"},"status":{"type":"string","example":"pending"},"createdAt":{"type":"string","format":"date-time","example":"2025-11-04T10:30:00Z"},"updatedAt":{"type":"string","format":"date-time","example":"2025-11-04T10:30:00Z"},"orderItems":{"type":"boolean","description":"Always true, indicates order items were created","example":true}}},"OrderRequest":{"type":"object","required":["table","customer","orderItems"],"properties":{"table":{"type":"string","minLength":1,"description":"Table number or identifier","example":"5"},"customer":{"type":"string","minLength":1,"description":"Customer name","example":"Mario Rossi"},"orderItems":{"type":"array","minItems":1,"description":"List of items in the order","items":{"$ref":"#/components/schemas/OrderItemInput"}},"confirm":{"allOf":[{"$ref":"#/components/schemas/ConfirmationData"},{"type":"object","description":"Optional confirmation data. If provided, the order will be created in CONFIRMED status.\nIf omitted, the order will be created in PENDING status.\n"}]}}},"Printer":{"type":"object","required":["name","ip"],"properties":{"id":{"type":"string","description":"The auto-generated id of the printer","example":"clx1a2b3c4d5e6f7g8h9i0j1"},"name":{"type":"string","description":"The name of the printer","example":"Kitchen Printer"},"ip":{"type":"string","description":"The IP address of the printer","example":"192.168.1.200"},"port":{"type":"integer","description":"The port of the printer","default":9100,"example":9100},"description":{"type":"string","description":"The description of the printer","example":"Printer located in the kitchen"},"status":{"type":"string","enum":["ONLINE","OFFLINE","ERROR"],"default":"ONLINE","description":"The status of the printer","example":"ONLINE"},"printerId":{"type":"string","description":"The CUID identifier of the printer","example":"clx1a2b3c4d5e6f7g8h9i0j1"}}},"PrinterInput":{"type":"object","required":["name","ip"],"properties":{"name":{"type":"string","description":"The name of the printer","example":"Kitchen Printer"},"ip":{"type":"string","description":"The IP address of the printer","example":"192.168.1.200"},"port":{"type":"integer","description":"The port of the printer","example":9100},"description":{"type":"string","description":"The description of the printer","example":"Printer located in the kitchen"},"status":{"type":"string","enum":["ONLINE","OFFLINE","ERROR"],"default":"ONLINE","description":"The status of the printer","example":"ONLINE"}}},"UserResponse":{"type":"object","properties":{"id":{"type":"string","example":"clxyz123456789abcdef"},"username":{"type":"string","example":"john_doe"},"role":{"type":"object","properties":{"id":{"type":"string","example":"clxyz123456789abcdef"},"name":{"type":"string","example":"admin"}}}}},"UserRequest":{"type":"object","properties":{"username":{"type":"string","minLength":6,"example":"john_doe"},"password":{"type":"string","minLength":8,"example":"password123"},"roleId":{"type":"string","example":"clxyz123456789abcdef"}}}}},"paths":{"/auth/login":{"post":{"summary":"Authenticate user","description":"Authenticate a user with username and password. Returns user information and access token in response body.\nThe refresh token is automatically set as an HTTP-only cookie named 'refreshToken' with 7 days expiration.\n","tags":["Auth"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginRequest"}}}},"responses":{"200":{"description":"User authenticated successfully. Access token returned in response body.\nRefresh token set as HTTP-only cookie 'refreshToken' (expires in 7 days).\n","headers":{"Set-Cookie":{"description":"HTTP-only refresh token cookie","schema":{"type":"string","example":"refreshToken=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...; HttpOnly; Secure; SameSite=Strict; Max-Age=604800; Path=/"}}},"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginResponse"}}}},"400":{"description":"Bad request - Missing username or password","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"message":"Bad request"}}}},"401":{"description":"Unauthorized - Invalid password","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"message":"Unauthorized"}}}},"404":{"description":"User not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"message":"User not exists"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}}},"/auth/logout":{"post":{"summary":"Logout user","description":"Revoke a refresh token to logout a user from a specific device/session.\nThe refresh token is automatically read from the 'refreshToken' HTTP-only cookie.\n\n**Testing in Swagger UI:**\n1. First call `/auth/login` to set the refresh token cookie\n2. Then call this endpoint - the cookie will be sent automatically\n3. Alternatively, manually set the cookie in your browser dev tools\n","tags":["Auth"],"security":[{"cookieAuth":[]}],"responses":{"200":{"description":"User logged out successfully (refresh token revoked)"},"400":{"description":"Bad request - Missing or invalid refresh token","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"message":"Bad request"}}}},"401":{"description":"Unauthorized - Invalid or expired refresh token","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"message":"Invalid token"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}}},"/auth/refresh":{"post":{"summary":"Refresh access token","description":"Generate a new access token using the refresh token.\nThe refresh token is automatically read from the 'refreshToken' HTTP-only cookie.\n\n**Testing in Swagger UI:**\n1. First call `/auth/login` to set the refresh token cookie\n2. When your access token expires, call this endpoint to get a new one\n3. The refresh token cookie will be sent automatically\n","tags":["Auth"],"security":[{"cookieAuth":[]}],"responses":{"200":{"description":"New access token generated successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RefreshResponse"}}}},"400":{"description":"Bad request - Refresh token missing","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"message":"Refresh token missing"}}}},"401":{"description":"Unauthorized - Invalid or expired refresh token","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"},"example":{"message":"Refresh token not valid"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}}},"/events/{channel}":{"get":{"tags":["Events (SSE)"],"summary":"Subscribe to Server-Sent Events (SSE) for real-time updates","description":"Establishes a persistent Server-Sent Events (SSE) connection to receive real-time updates for a specific channel.\n\n**How SSE works:**\n- Client opens a long-lived HTTP connection\n- Server pushes updates to the client as they occur\n- Connection stays open with periodic keep-alive messages every 15 seconds\n- Client automatically reconnects if connection is lost\n\n**Available Channels:**\n\n**`order`** - Order events channel\n- Broadcasts real-time updates when orders are created, updated, or deleted\n- Event data includes complete order information with items\n- Use case: Display live order feed in kitchen display systems or operator dashboards\n- Message format: Complete order object matching the POST /v1/orders response\n\n**Connection details:**\n- Content-Type: `text/event-stream`\n- Keep-alive messages sent every 15 seconds (`: keep-alive\\n\\n`)\n- Data messages format: `data: {JSON}\\n\\n`\n\n**Example client implementation (JavaScript):**\n```javascript\nconst eventSource = new EventSource('/v1/events/order', {\n  headers: { 'Authorization': 'Bearer YOUR_TOKEN' }\n});\n\neventSource.onmessage = (event) => {\n  const orderData = JSON.parse(event.data);\n  console.log('New order:', orderData);\n};\n\neventSource.onerror = (error) => {\n  console.error('SSE error:', error);\n};\n```\n","security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"channel","required":true,"description":"Event channel to subscribe to.\nCurrently available: `cashier, display`\n","schema":{"type":"string","enum":["cashier","display"],"example":"cashier"}}],"responses":{"200":{"description":"SSE connection established successfully. Stream remains open for real-time updates.","content":{"text/event-stream":{"schema":{"type":"string","description":"Server-Sent Events stream. Messages are sent in the format:\n- Keep-alive: `: keep-alive\\n\\n`\n- Data event: `data: {JSON}\\n\\n`\n"},"examples":{"keepAlive":{"summary":"Keep-alive heartbeat message","value":": keep-alive\n\n"},"orderCreated":{"summary":"New order created event (order channel)","value":"data: {\"id\":123,\"displayCode\":\"A01\",\"table\":\"5\",\"customer\":\"Mario Rossi\",\"subTotal\":\"25.50\",\"createdAt\":\"2025-11-08T10:30:00Z\",\"orderItems\":[{\"id\":\"clx123\",\"quantity\":2,\"foodId\":\"clx456\",\"notes\":null}]}\n"}}}}},"400":{"description":"Invalid channel parameter","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string","example":"Validation error"},"errors":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}}}}}},"example":{"message":"Validation error","errors":[{"field":"channel","message":"Invalid enum value. Expected 'order'"}]}}}},"401":{"description":"Unauthorized - Authentication required","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string","example":"Unauthorized"}}}}}},"403":{"description":"Forbidden - Insufficient permissions (operators and administrators only)","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string","example":"Forbidden - Insufficient permissions"}}}}}}}}},"/v1/cash-registers":{"get":{"summary":"Get all cash registers","tags":["CashRegisters"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"query","name":"include","schema":{"type":"string","enum":["printer"]},"description":"Include related resources (e.g. printer)"},{"in":"query","name":"enabled","schema":{"type":"boolean"},"description":"Filter by enabled status"}],"responses":{"200":{"description":"The list of the cash registers","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/CashRegister"}}}}}}},"post":{"summary":"Create a new cash register","tags":["CashRegisters"],"security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CashRegisterInput"}}}},"responses":{"201":{"description":"The cash register was successfully created","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CashRegister"}}}},"400":{"description":"Invalid input"}}}},"/v1/cash-registers/{id}":{"get":{"summary":"Get the cash register by id","tags":["CashRegisters"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","schema":{"type":"string"},"required":true,"description":"The cash register id"},{"in":"query","name":"include","schema":{"type":"string","enum":["printer"]},"description":"Include related resources (e.g. printer)"}],"responses":{"200":{"description":"The cash register description by id","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CashRegister"}}}},"404":{"description":"The cash register was not found"}}},"put":{"summary":"Update the cash register by the id","tags":["CashRegisters"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","schema":{"type":"string"},"required":true,"description":"The cash register id"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CashRegisterInput"}}}},"responses":{"200":{"description":"The cash register was updated","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CashRegister"}}}},"404":{"description":"The cash register was not found"}}},"patch":{"summary":"Update the cash register status by the id","tags":["CashRegisters"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","schema":{"type":"string"},"required":true,"description":"The cash register id"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CashRegisterPatchInput"}}}},"responses":{"200":{"description":"The cash register status was updated","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CashRegister"}}}},"404":{"description":"The cash register was not found"}}},"delete":{"summary":"Remove the cash register by id","tags":["CashRegisters"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","schema":{"type":"string"},"required":true,"description":"The cash register id"}],"responses":{"200":{"description":"The cash register was deleted"},"404":{"description":"The cash register was not found"}}}},"/v1/categories":{"get":{"summary":"Get all categories","description":"Retrieves all categories from the database with optional filtering and food inclusion.\n\n**Authentication:**\n- If `available=true` is specified: Public endpoint, no authentication required\n- If `available=false` or not specified: Requires admin authentication\n\n**Query Parameters:**\n- `available`: Filter by availability status\n- `include`: Include related resources (use 'foods' to include foods with their ingredients)\n","tags":["Categories"],"security":[{"bearerAuth":[]},{}],"parameters":[{"in":"query","name":"available","schema":{"type":"boolean"},"description":"Filter categories by availability"},{"in":"query","name":"include","schema":{"type":"string","enum":["foods"]},"description":"Include related resources (e.g. foods)"}],"responses":{"200":{"description":"List of categories","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/CategoryResponse"}}}}}}},"post":{"security":[{"bearerAuth":[]}],"summary":"Create a new category","tags":["Categories"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CategoryRequest"}}}},"responses":{"201":{"description":"Category created successfully"},"400":{"description":"Invalid request body"}}}},"/v1/categories/{id}":{"get":{"security":[{"bearerAuth":[]}],"summary":"Get a category by ID","tags":["Categories"],"parameters":[{"in":"path","name":"id","required":true,"description":"ID of the category to retrieve","schema":{"type":"string"},"example":"clxyz123456789abcdef"},{"in":"query","name":"include","schema":{"type":"string","enum":["foods"]},"description":"Include related resources (e.g. foods)"}],"responses":{"200":{"description":"Category retrieved successfully"},"404":{"description":"Category not found"}}},"put":{"security":[{"bearerAuth":[]}],"summary":"Update a category","tags":["Categories"],"parameters":[{"in":"path","name":"id","required":true,"description":"ID of the category to update","schema":{"type":"string"},"example":"clxyz123456789abcdef"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CategoryRequest"}}}},"responses":{"200":{"description":"Category updated successfully"},"400":{"description":"Invalid request body"},"404":{"description":"Category not found"},"409":{"description":"Category conflict"}}},"patch":{"security":[{"bearerAuth":[]}],"summary":"Update availability status of a category","description":"Update the availability of a category. Note that changing the availability of a category will also update the availability of all associated foods.","tags":["Categories"],"parameters":[{"in":"path","name":"id","required":true,"description":"ID of the category to update","schema":{"type":"string"},"example":"clxyz123456789abcdef"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"available":{"type":"boolean","description":"The new availability status of the category"}},"example":{"available":true}}}}},"responses":{"200":{"description":"Category availability updated successfully"},"404":{"description":"Category not found"}}},"delete":{"security":[{"bearerAuth":[]}],"summary":"Delete a category","tags":["Categories"],"parameters":[{"in":"path","name":"id","required":true,"description":"ID of the category to delete","schema":{"type":"string"},"example":"clxyz123456789abcdef"}],"responses":{"204":{"description":"Category deleted successfully"},"404":{"description":"Category not found"}}}},"/v1/categories/{id}/image":{"patch":{"security":[{"bearerAuth":[]}],"summary":"Update category image","tags":["Categories"],"parameters":[{"in":"path","name":"id","required":true,"description":"ID of the category to update","schema":{"type":"string"},"example":"clxyz123456789abcdef"}],"requestBody":{"required":true,"content":{"multipart/form-data":{"schema":{"type":"object","properties":{"image":{"type":"string","format":"binary","description":"Image file to upload for the category"}},"required":["image"]}}}},"responses":{"200":{"description":"Category image updated successfully"},"400":{"description":"Invalid image file or missing image"},"404":{"description":"Category not found"}}}},"/v1/foods":{"get":{"security":[{"bearerAuth":[]}],"summary":"Get all foods","description":"Retrieves all foods from the database. Supports optional filtering and ingredient inclusion.\n\n**Query Parameters:**\n- `include`: Include additional data (use 'ingredients' to include ingredient details)\n- `available`: Filter by availability status (true/false)\n- `category`: Filter by category names (can be used multiple times)\n\n**Authorization:**\n- Non-admin users can only access foods with `available=true`\n- Admin users can access all foods regardless of availability\n","tags":["Foods"],"parameters":[{"in":"query","name":"include","required":false,"description":"Include additional data (use 'ingredients' to include ingredient details)","schema":{"type":"string","enum":["ingredients"]},"example":"ingredients"},{"in":"query","name":"available","required":false,"description":"Filter by availability status. Leave empty to show all (admin only).","schema":{"type":"boolean"},"example":true},{"in":"query","name":"category","required":false,"description":"Filter by category names (can be used multiple times for multiple categories). Leave empty to show all categories.","schema":{"type":"array","items":{"type":"string"}},"style":"form","explode":true,"example":"Pizzeria"}],"responses":{"200":{"description":"A list of foods","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/FoodResponse"}}}}}}},"post":{"security":[{"bearerAuth":[]}],"summary":"Create a new food item","tags":["Foods"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FoodRequest"}}}},"responses":{"201":{"description":"Food item created successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FoodResponse"}}}},"400":{"description":"Invalid request body"},"401":{"description":"Unauthorized - Non-admin users can only access available foods"},"409":{"description":"Food name already exists"}}}},"/v1/foods/{id}":{"put":{"security":[{"bearerAuth":[]}],"summary":"Update a food item","tags":["Foods"],"parameters":[{"in":"path","name":"id","required":true,"description":"ID of the food item to update","schema":{"type":"string","format":"cuid"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FoodRequest"}}}},"responses":{"200":{"description":"Food item updated successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FoodResponse"}}}},"400":{"description":"Invalid request body or invalid ID parameter"},"404":{"description":"Food item not found"},"409":{"description":"Food name already exists"}}},"patch":{"security":[{"bearerAuth":[]}],"summary":"Update availability status or printer of a food item","tags":["Foods"],"parameters":[{"in":"path","name":"id","required":true,"description":"ID of the food item to update","schema":{"type":"string","format":"cuid"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"available":{"type":"boolean","description":"New availability status","example":false}}}}}},"responses":{"200":{"description":"Food availability updated successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FoodResponse"}}}},"400":{"description":"Invalid ID parameter or request body"},"401":{"description":"Unauthorized - Authentication required"},"403":{"description":"Forbidden - Admin access required"},"404":{"description":"Food item not found"}}},"delete":{"security":[{"bearerAuth":[]}],"summary":"Delete a food item","tags":["Foods"],"parameters":[{"in":"path","name":"id","required":true,"description":"ID of the food item to delete","schema":{"type":"string","format":"cuid"}}],"responses":{"204":{"description":"Food item deleted successfully"},"400":{"description":"Invalid ID parameter"},"404":{"description":"Food item not found"}}},"get":{"security":[{"bearerAuth":[]}],"summary":"Get a food item by ID","tags":["Foods"],"parameters":[{"in":"path","name":"id","required":true,"description":"ID of the food item to retrieve","schema":{"type":"string","format":"cuid"}},{"in":"query","name":"include","required":false,"description":"Include additional data (use 'ingredients' to include ingredient details)","schema":{"type":"string","enum":["ingredients"]}}],"responses":{"200":{"description":"Food item retrieved successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FoodResponse"}}}},"400":{"description":"Invalid ID parameter"},"404":{"description":"Food item not found"}}}},"/v1/ingredients":{"get":{"security":[{"bearerAuth":[]}],"summary":"Get all ingredients","tags":["Ingredients"],"responses":{"200":{"description":"A list of ingredients","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/IngredientResponse"}}}}},"401":{"description":"Unauthorized"}}},"post":{"security":[{"bearerAuth":[]}],"summary":"Create a new ingredient","tags":["Ingredients"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/IngredientRequest"}}}},"responses":{"201":{"description":"Ingredient created successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/IngredientResponse"}}}},"400":{"description":"Invalid request body"},"401":{"description":"Unauthorized"},"409":{"description":"Ingredient name already exists"}}}},"/v1/ingredients/{id}":{"get":{"security":[{"bearerAuth":[]}],"summary":"Get an ingredient by ID","tags":["Ingredients"],"parameters":[{"in":"path","name":"id","required":true,"description":"ID of the ingredient to retrieve","schema":{"type":"string"}}],"responses":{"200":{"description":"Ingredient retrieved successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/IngredientResponse"}}}},"400":{"description":"Invalid ID parameter"},"401":{"description":"Unauthorized"},"404":{"description":"Ingredient not found"}}},"put":{"security":[{"bearerAuth":[]}],"summary":"Update an ingredient","tags":["Ingredients"],"parameters":[{"in":"path","name":"id","required":true,"description":"ID of the ingredient to update","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/IngredientRequest"}}}},"responses":{"200":{"description":"Ingredient updated successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/IngredientResponse"}}}},"400":{"description":"Invalid request body or invalid ID parameter"},"401":{"description":"Unauthorized"},"404":{"description":"Ingredient not found"},"409":{"description":"Ingredient name already exists"}}},"delete":{"security":[{"bearerAuth":[]}],"summary":"Delete an ingredient","tags":["Ingredients"],"parameters":[{"in":"path","name":"id","required":true,"description":"ID of the ingredient to delete","schema":{"type":"string"}}],"responses":{"204":{"description":"Ingredient deleted successfully"},"400":{"description":"Invalid ID parameter"},"401":{"description":"Unauthorized"},"404":{"description":"Ingredient not found"}}}},"/v1/orders":{"get":{"security":[{"bearerAuth":[]}],"summary":"Get orders with advanced filtering and pagination","description":"Returns a paginated and filtered list of orders with basic information only.\nUse GET /{code} to retrieve full order details including items, categories and ingredients.\n\n**Filtering options:**\n- Search by customer name, table or order code\n- Filter by order status (PENDING, CONFIRMED, COMPLETED, PICKED_UP)\n- Filter by date range\n\n**Important notes:**\n- Cannot filter by 'status' when 'confirmed' is false (unconfirmed orders don't have status)\n- Multiple statuses can be provided (e.g., status=CONFIRMED&status=COMPLETED)\n- Date filters use inclusive ranges\n","tags":["Orders"],"parameters":[{"in":"query","name":"search","required":false,"description":"Search by customer name, table number, or order code","schema":{"type":"string","example":"Mario"}},{"in":"query","name":"displayCode","required":false,"description":"Filter by orderCode","schema":{"type":"string","example":"A01"}},{"in":"query","name":"page","required":false,"description":"Page number for pagination (1-based)","schema":{"type":"integer","minimum":1,"default":1,"example":1}},{"in":"query","name":"limit","required":false,"description":"Number of items per page (max 100)","schema":{"type":"integer","minimum":1,"maximum":100,"default":20,"example":20}},{"in":"query","name":"sortBy","required":false,"description":"Field to sort by","schema":{"type":"string","enum":["createdAt"],"default":"createdAt","example":"createdAt"}},{"in":"query","name":"status","required":false,"description":"Filter by order status (can be used multiple times for multiple statuses). Cannot be used when confirmed=false. Leave empty to show all statuses.","schema":{"type":"array","items":{"type":"string","enum":["PENDING","CONFIRMED","COMPLETED","PICKED_UP"]}},"style":"form","explode":true,"example":["CONFIRMED"]},{"in":"query","name":"dateFrom","required":false,"description":"Start date for date range filter (inclusive). Click to open date picker.","schema":{"type":"string","format":"date-time"},"example":"2025-11-01T00:00:00Z"},{"in":"query","name":"dateTo","required":false,"description":"End date for date range filter (inclusive). Click to open date picker.","schema":{"type":"string","format":"date-time"},"example":"2025-11-30T23:59:59Z"}],"responses":{"200":{"description":"Paginated and filtered list of orders","content":{"application/json":{"schema":{"type":"object","properties":{"orders":{"type":"array","items":{"$ref":"#/components/schemas/OrderListResponse"}},"pagination":{"type":"object","properties":{"currentPage":{"type":"integer","example":1},"totalOrdersPages":{"type":"integer","example":5},"totalOrdersItems":{"type":"integer","example":100},"itemsPerPage":{"type":"integer","example":20},"hasNextPage":{"type":"boolean","example":true},"hasPrevPage":{"type":"boolean","example":false},"nextPage":{"type":"integer","nullable":true,"example":2},"prevPage":{"type":"integer","nullable":true,"example":null}}}}}}}},"400":{"description":"Invalid query parameters or validation error (e.g., using status filter with confirmed=false)","content":{"application/json":{"schema":{"type":"object","properties":{"errors":{"type":"object","properties":{"status":{"type":"array","items":{"type":"string"},"example":["You cannot filter by 'status' when 'confirmed' is 'false'"]}}}}}}}},"401":{"description":"Unauthorized - Authentication required"},"403":{"description":"Forbidden - Insufficient permissions"}}},"post":{"security":[{"bearerAuth":[]}],"summary":"Create a new order (with or without immediate confirmation)","description":"Creates a new order with items. This endpoint supports two operational modes:\n\n**1. Create PENDING order (without confirmation data):**\n- Creates an order in PENDING status\n- The order is NOT locked and can be accessed by any client\n- No ticket number is assigned yet\n- No payment information is stored\n- Useful for orders that need to be reviewed before payment\n\n**2. Create and CONFIRM order (with confirmation data):**\n- Creates an order and immediately confirms it\n- Status is set to CONFIRMED\n- A daily progressive ticket number is assigned\n- Payment information is stored\n- Total is calculated: subtotal + surcharge - discount\n- Broadcasts confirmation event to displays\n\n**Price calculation:**\n- Each item total: surcharge + (unitPrice × quantity)\n- Subtotal = Σ(item.total)\n- Order surcharge = Σ(item.surcharge)\n- If confirm data is provided: Total = Subtotal - discount\n\n**Note:** Returns lightweight response without food details. Use GET /{id} to retrieve full order details.\n\n**Authentication:** Requires bearer token (admin or operator role).\n","tags":["Orders"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/OrderRequest"},"examples":{"withConfirmation":{"summary":"Create and confirm order (recommended)","description":"Creates an order and immediately confirms it with payment information","value":{"table":"5","customer":"Mario Rossi","orderItems":[{"foodId":"clx1a2b3c4d5e6f7g8h9i0j1","quantity":2,"notes":"No onions, extra cheese","surcharge":1.5},{"foodId":"clx9z8y7x6w5v4u3t2s1r0q9","quantity":1,"notes":"Well done","surcharge":0}],"confirm":{"paymentMethod":"CASH","discount":2.5,"userId":"clx1a2b3c4d5e6f7g8h9i0j1","cashRegisterId":"clx9z8y7x6w5v4u3t2s1r0q9"}}},"withoutConfirmation":{"summary":"Create pending order (no authentication required)","description":"Creates a PENDING order without payment info - accessible by all clients","value":{"table":"5","customer":"Mario Rossi","orderItems":[{"foodId":"clx1a2b3c4d5e6f7g8h9i0j1","quantity":2,"notes":"No onions, extra cheese","surcharge":0},{"foodId":"clx9z8y7x6w5v4u3t2s1r0q9","quantity":1,"surcharge":0}]}}}}}},"responses":{"201":{"description":"Order created successfully (lightweight, no food details)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/OrderCreateResponse"},"examples":{"confirmed":{"summary":"Confirmed order response","value":{"id":"clx1a2b3c4d5e6f7g8h9i0j1","displayCode":"A01","table":"5","customer":"Mario Rossi","subTotal":"25.50","total":"24.00","discount":2.5,"surcharge":1,"paymentMethod":"CASH","status":"CONFIRMED","ticketNumber":42,"confirmedAt":"2025-11-12T10:30:00Z","createdAt":"2025-11-12T10:30:00Z","updatedAt":"2025-11-12T10:30:00Z","orderItems":true}},"pending":{"summary":"Pending order response","value":{"id":"clx1a2b3c4d5e6f7g8h9i0j1","displayCode":"A01","table":"5","customer":"Mario Rossi","subTotal":"25.50","total":"25.50","discount":0,"surcharge":0,"paymentMethod":null,"status":"PENDING","ticketNumber":null,"confirmedAt":null,"createdAt":"2025-11-12T10:30:00Z","updatedAt":"2025-11-12T10:30:00.000Z","orderItems":true}}}}}},"400":{"description":"Invalid request body or food items not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"},"example":{"error":"One or more requested products do not exist or are invalid"}}}},"401":{"description":"Unauthorized - Authentication required"},"403":{"description":"Forbidden - Insufficient permissions"}}}},"/v1/orders/{id}":{"get":{"security":[{"bearerAuth":[]}],"summary":"Get order details by ID","description":"Retrieves complete order details by its numeric ID, including all items grouped by category\nwith full food information and ingredients.\n\n**Response structure:**\n- Order items are grouped by food category for better organization\n- Each food item includes its full details (name, description, price, availability)\n- Ingredients are provided as a flat array (not nested in foodIngredients)\n- Includes all order information (payment details, status, ticket number if confirmed)\n\n**Use cases:**\n- Display order details in the cashier interface\n- Show order items grouped by category for kitchen preparation\n- Retrieve order for confirmation or modification\n\n**Authentication:** Requires bearer token (admin or operator role).\n","tags":["Orders"],"parameters":[{"in":"path","name":"id","required":true,"description":"Numeric order ID","schema":{"type":"integer","minimum":1,"example":42}}],"responses":{"200":{"description":"Order details retrieved successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/OrderDetailResponse"},"example":{"id":42,"displayCode":"A01","table":"5","customer":"Mario Rossi","subTotal":"25.50","createdAt":"2025-11-12T10:30:00.000Z","categorizedItems":[{"category":{"id":1,"name":"Pizza"},"items":[{"id":"clm1234567890","quantity":2,"notes":"No onions, extra cheese","food":{"id":"clx1a2b3c4d5e6f7g8h9i0j1","name":"Pizza Margherita","description":"Classic pizza with tomato and mozzarella","price":"8.50","ingredients":[{"id":"clm111","name":"Mozzarella"},{"id":"clm222","name":"Tomato Sauce"}]}}]},{"category":{"id":2,"name":"Drinks"},"items":[{"id":"clm9876543210","quantity":1,"notes":null,"food":{"id":"clx9z8y7x6w5v4u3t2s1r0q9","name":"Coca Cola","description":"330ml can","price":"2.50","ingredients":[]}}]}]}}}},"400":{"description":"Invalid order ID format","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"},"example":{"error":"Order ID must be a positive integer"}}}},"401":{"description":"Unauthorized - Authentication required"},"403":{"description":"Forbidden - Insufficient permissions"},"404":{"description":"Order not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"},"example":{"error":"Order not found"}}}}}},"patch":{"security":[{"bearerAuth":[]}],"summary":"Update order status","description":"Updates the status of an existing order. This endpoint allows transitioning orders\nthrough different states in the order lifecycle.\n\n**Status transitions:**\n- You can transition from any state to any other state directly.\n- For example, you can go from PENDING to COMPLETED without passing through CONFIRMED.\n\n**Use cases:**\n- Mark order as completed when delivered to customer\n- Mark order as picked up when customer collects it\n- Update order workflow status in kitchen/cashier systems\n- Manually correct order status if needed\n\n**Important notes:**\n- Status changes are permanent and cannot be undone\n\n**Authentication:** Requires bearer token (admin or operator role).\n","tags":["Orders"],"parameters":[{"in":"path","name":"id","required":true,"description":"Numeric order ID to update","schema":{"type":"integer","minimum":1},"example":42}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["status"],"properties":{"status":{"allOf":[{"$ref":"#/components/schemas/OrderStatus"},{"description":"New status for the order","example":"COMPLETED"}]}}},"examples":{"markCompleted":{"summary":"Mark order as completed","description":"Used when order has been delivered/served to customer","value":{"status":"COMPLETED"}},"markPickedUp":{"summary":"Mark order as picked up","description":"Used when customer has collected the order","value":{"status":"PICKED_UP"}}}}}},"responses":{"200":{"description":"Order status updated successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/OrderBase"},"example":{"id":42,"displayCode":"A01","table":"5","customer":"Mario Rossi","status":"COMPLETED","ticketNumber":15,"total":47,"subTotal":50,"discount":5,"surcharge":2,"paymentMethod":"CASH","confirmedAt":"2025-11-12T14:30:00.000Z","createdAt":"2025-11-12T14:00:00.000Z"}}}},"400":{"description":"Invalid request or validation error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"},"examples":{"invalidStatus":{"summary":"Invalid status value","value":{"error":"Invalid status. Must be one of: PENDING, CONFIRMED, COMPLETED, PICKED_UP"}}}}}},"401":{"description":"Unauthorized - Authentication required"},"403":{"description":"Forbidden - Insufficient permissions"},"404":{"description":"Order not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"},"example":{"error":"Order not found"}}}}}},"delete":{"security":[{"bearerAuth":[]}],"summary":"Delete an order","description":"Permanently deletes an order and all its associated items from the system.\n\n**Use cases:**\n- Remove cancelled orders\n- Clean up test or erroneous orders\n- Maintain database hygiene\n\n**Important notes:**\n- This action is permanent and cannot be undone\n- All order items will be deleted as well\n- Consider the impact on reporting and analytics before deletion\n\n**Authentication:** Requires bearer token (admin or operator role).\n","tags":["Orders"],"parameters":[{"in":"path","name":"id","required":true,"description":"Numeric order ID to delete","schema":{"type":"integer","minimum":1,"example":42}}],"responses":{"204":{"description":"Order deleted successfully (no content returned)"},"400":{"description":"Invalid order ID parameter","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"},"example":{"error":"Order ID must be a positive integer"}}}},"401":{"description":"Unauthorized - Authentication required"},"403":{"description":"Forbidden - Insufficient permissions"},"404":{"description":"Order not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"},"example":{"error":"Order not found"}}}}}}},"/v1/orders/{id}/confirm":{"post":{"tags":["Orders"],"summary":"Confirm a PENDING order","description":"Confirms an existing PENDING order by assigning a daily progressive ticket number,\ncalculating the final total with discounts/surcharges, and storing payment information.\n\n**Use cases:**\n- Confirm an order that was previously created in PENDING status\n- Optionally modify order items before confirmation\n- Apply discounts or surcharges to the final total\n\n**Operational flow:**\n1. Validates that the order exists and is in PENDING status\n2. **Order Items Management:**\n   - If `orderItems` is provided: replaces all existing items with the new ones\n   - If `orderItems` is omitted: keeps existing items unchanged\n3. Recalculates subtotal based on current/new items\n4. Applies discount and surcharge to calculate final total\n5. Assigns a daily progressive ticket number (resets daily at noon)\n6. Updates order status to CONFIRMED\n7. Broadcasts confirmation event to display systems\n\n**Total calculation:**\n- Each item total: surcharge + (unitPrice × quantity)\n- Subtotal = Σ(item.total)\n- Order surcharge = Σ(item.surcharge)\n- Total = Subtotal - discount\n- If total becomes negative, it's set to 0\n\n**Important notes:**\n- Only PENDING orders can be confirmed\n- Ticket numbers are progressive and reset daily at 12:00 PM\n- If orderItems are provided, they must reference available food items\n- The confirmation cannot be undone\n","security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"description":"Order ID to confirm (must be in PENDING status)","schema":{"type":"integer","minimum":1},"example":42}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"allOf":[{"$ref":"#/components/schemas/ConfirmationData"},{"type":"object","description":"Confirmation data with optional orderItems.\nIf orderItems is omitted, existing items will be kept unchanged.\nIf provided, all previous items will be deleted and replaced.\n"}]},"examples":{"withNewItems":{"summary":"Confirm with modified items","description":"Replaces existing items and confirms the order","value":{"userId":"clx1a2b3c4d5e6f7g8h9i0j1","cashRegisterId":"clx9z8y7x6w5v4u3t2s1r0q9","paymentMethod":"CASH","discount":5,"orderItems":[{"foodId":"clm1234567890","quantity":2,"notes":"Extra spicy","surcharge":1.5},{"foodId":"clm9876543210","quantity":1,"notes":"No onions","surcharge":0}]}},"withoutNewItems":{"summary":"Confirm with existing items","description":"Keeps existing items and only adds payment info","value":{"paymentMethod":"CARD","discount":0}},"withDiscountOnly":{"summary":"Confirm with discount only","value":{"paymentMethod":"CASH","discount":10}}}}}},"responses":{"200":{"description":"Order confirmed successfully","content":{"application/json":{"schema":{"allOf":[{"$ref":"#/components/schemas/OrderBase"},{"type":"object","properties":{"orderItems":{"type":"array","description":"Order items (basic info without food details)","items":{"type":"object"}}}}]},"examples":{"confirmed":{"summary":"Successfully confirmed order","value":{"id":42,"userId":"clx1a2b3c4d5e6f7g8h9i0j1","cashRegisterId":"clx9z8y7x6w5v4u3t2s1r0q9","displayCode":"A01","table":"5","customer":"Mario Rossi","ticketNumber":15,"status":"CONFIRMED","paymentMethod":"CASH","discount":5,"surcharge":2,"subTotal":50,"total":47,"confirmedAt":"2025-11-12T14:30:00.000Z","createdAt":"2025-11-12T14:00:00.000Z","orderItems":[]}}}}}},"400":{"description":"Invalid request or validation error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"},"examples":{"invalidItems":{"summary":"Invalid food items","value":{"error":"One or more products do not exist or are not available"}},"alreadyConfirmed":{"summary":"Order already confirmed","value":{"error":"Order is already confirmed"}}}}}},"401":{"description":"Unauthorized - Authentication required"},"403":{"description":"Forbidden - Insufficient permissions"},"404":{"description":"Order not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"},"example":{"error":"Order not found"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"},"example":{"error":"Server error"}}}}}}},"/v1/printers":{"get":{"summary":"Get all printers","tags":["Printers"],"security":[{"bearerAuth":[]}],"responses":{"200":{"description":"The list of the printers","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Printer"}}}}}}},"post":{"summary":"Create a new printer","tags":["Printers"],"security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PrinterInput"}}}},"responses":{"201":{"description":"The printer was successfully created","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Printer"}}}},"400":{"description":"Invalid input"}}}},"/v1/printers/{id}":{"get":{"summary":"Get the printer by id","tags":["Printers"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","schema":{"type":"string"},"required":true,"description":"The printer id"}],"responses":{"200":{"description":"The printer description by id","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Printer"}}}},"404":{"description":"The printer was not found"}}},"put":{"summary":"Update the printer by the id","tags":["Printers"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","schema":{"type":"string"},"required":true,"description":"The printer id"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PrinterInput"}}}},"responses":{"200":{"description":"The printer was updated","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Printer"}}}},"404":{"description":"The printer was not found"}}},"patch":{"summary":"Update the status of a printer","description":"Update the status of a printer by its ID. This endpoint allows changing the printer status to ONLINE, OFFLINE, or ERROR.","tags":["Printers"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","schema":{"type":"string"},"required":true,"description":"The printer id"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["status"],"properties":{"status":{"type":"string","enum":["ONLINE","OFFLINE","ERROR"],"description":"The new status of the printer","example":"OFFLINE"}}}}}},"responses":{"200":{"description":"The printer status was updated","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Printer"}}}},"400":{"description":"Invalid input"},"404":{"description":"The printer was not found"}}},"delete":{"summary":"Remove the printer by id","tags":["Printers"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","schema":{"type":"string"},"required":true,"description":"The printer id"}],"responses":{"200":{"description":"The printer was deleted"},"404":{"description":"The printer was not found"}}}},"/v1/roles":{"get":{"security":[{"bearerAuth":[]}],"summary":"Get all roles","tags":["Roles"],"responses":{"200":{"description":"List of roles","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string","example":"cjld2cyuq0000t3rmniod1foy"},"name":{"type":"string","example":"admin"}}}}}}},"404":{"description":"Roles not found"}}}},"/v1/roles/{id}":{"get":{"security":[{"bearerAuth":[]}],"summary":"Get a role by ID","tags":["Roles"],"parameters":[{"in":"path","name":"id","required":true,"description":"ID of the role","schema":{"type":"string"}}],"responses":{"200":{"description":"Role found","content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string","example":"cjld2cyuq0000t3rmniod1foy"},"name":{"type":"string","example":"admin"}}}}}},"404":{"description":"Role not found"}}}},"/v1/users":{"get":{"security":[{"bearerAuth":[]}],"summary":"Get all users","tags":["Users"],"responses":{"200":{"description":"List of users","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/UserResponse"}}}}},"401":{"description":"Unauthorized"},"403":{"description":"Forbidden"}}},"post":{"security":[{"bearerAuth":[]}],"summary":"Create a new user","tags":["Users"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserRequest"}}}},"responses":{"201":{"description":"User created successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponse"}}}},"400":{"description":"Invalid request body"},"401":{"description":"Unauthorized"},"403":{"description":"Forbidden"},"409":{"description":"Username already exists"}}}},"/v1/users/{id}":{"put":{"security":[{"bearerAuth":[]}],"summary":"Update a user","tags":["Users"],"parameters":[{"in":"path","name":"id","required":true,"description":"ID of the user to update","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserRequest"}}}},"responses":{"200":{"description":"User updated successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponse"}}}},"400":{"description":"Invalid request body"},"401":{"description":"Unauthorized"},"403":{"description":"Forbidden"},"404":{"description":"User not found"}}},"delete":{"security":[{"bearerAuth":[]}],"summary":"Delete a user","tags":["Users"],"parameters":[{"in":"path","name":"id","required":true,"description":"ID of the user to delete","schema":{"type":"string"}}],"responses":{"204":{"description":"User deleted successfully"},"400":{"description":"Invalid user ID"},"401":{"description":"Unauthorized"},"403":{"description":"Forbidden"},"404":{"description":"User not found"}}},"get":{"security":[{"bearerAuth":[]}],"summary":"Get a user by ID","tags":["Users"],"parameters":[{"in":"path","name":"id","required":true,"description":"ID of the user to retrieve","schema":{"type":"string"}}],"responses":{"200":{"description":"User retrieved successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponse"}}}},"400":{"description":"Invalid user ID"},"401":{"description":"Unauthorized"},"403":{"description":"Forbidden"},"404":{"description":"User not found"}}}}}}